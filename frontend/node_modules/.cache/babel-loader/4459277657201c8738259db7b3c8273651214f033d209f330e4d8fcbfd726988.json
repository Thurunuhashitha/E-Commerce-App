{"ast":null,"code":"import { create } from \"zustand\";\nimport axios from '../lib/axios.js'; // ✅ ESM requires file extension\n\nimport { toast } from \"react-hot-toast\";\nexport const useCartStore = create((set, get) => ({\n  cart: [],\n  coupon: null,\n  total: 0,\n  subtotal: 0,\n  isCouponApplied: false,\n  getCartItems: async () => {\n    try {\n      const res = await axios.get(\"/cart\");\n      set({\n        cart: res.data\n      });\n      get().calculateTotals();\n    } catch (error) {\n      set({\n        cart: []\n      });\n      toast.error(error.response.data.message || \"An error occurred\");\n    }\n  },\n  addToCart: async product => {\n    try {\n      await axios.post(\"/cart\", {\n        productId: product._id\n      });\n      toast.success(\"Product added to cart\");\n      set(prevState => {\n        const existingItem = prevState.cart.find(item => item._id === product._id);\n        const newCart = existingItem ? prevState.cart.map(item => item._id === product._id ? {\n          ...item,\n          quantity: item.quantity + 1\n        } : item) : [...prevState.cart, {\n          ...product,\n          quantity: 1\n        }];\n        return {\n          cart: newCart\n        };\n      });\n      get().calculateTotals();\n    } catch (error) {\n      toast.error(error.response.data.message || \"An error occurred\");\n    }\n  },\n  clearCart: async () => {\n    set({\n      cart: [],\n      coupon: null,\n      total: 0,\n      subtotal: 0\n    });\n  },\n  calculateTotals: () => {\n    const {\n      cart,\n      coupon\n    } = get();\n    const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);\n    let total = subtotal;\n    if (coupon) {\n      const discount = subtotal * (coupon.discountPercentage / 100);\n      total = subtotal - discount;\n    }\n    set({\n      subtotal,\n      total\n    });\n  },\n  removeFromCart: async productId => {\n    await axios.delete(`/cart`, {\n      data: {\n        productId\n      }\n    });\n    set(prevState => ({\n      cart: prevState.cart.filter(item => item._id !== productId)\n    }));\n    get().calculateTotals();\n    toast.success(\"Product removed from cart\");\n  },\n  updateQuantity: async (productId, quantity) => {\n    if (quantity === 0) {\n      get().removeFromCart(productId);\n      return;\n    }\n    await axios.put(`/cart/${productId}`, {\n      quantity\n    });\n    set(prevState => ({\n      cart: prevState.cart.map(item => item._id === productId ? {\n        ...item,\n        quantity\n      } : item)\n    }));\n    get().calculateTotals();\n  },\n  applyCoupon: async code => {\n    try {\n      const response = await axios.post(\"/coupons/validate\", {\n        code\n      });\n      set({\n        coupon: response.data,\n        isCouponApplied: true\n      });\n      get().calculateTotals();\n      toast.success(\"Coupon applied successfully\");\n    } catch (error) {\n      var _error$response, _error$response$data;\n      toast.error(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || \"Failed to apply coupon\");\n    }\n  },\n  getMyCoupon: async () => {\n    try {\n      const response = await axios.get(\"/coupons\");\n      set({\n        coupon: response.data\n      });\n    } catch (error) {\n      console.error(\"Error fetching coupon:\", error);\n    }\n  },\n  removeCoupon: () => {\n    set({\n      coupon: null,\n      isCouponApplied: false\n    });\n    get().calculateTotals();\n    toast.success(\"Coupon removed\");\n  }\n}));","map":{"version":3,"names":["create","axios","toast","useCartStore","set","get","cart","coupon","total","subtotal","isCouponApplied","getCartItems","res","data","calculateTotals","error","response","message","addToCart","product","post","productId","_id","success","prevState","existingItem","find","item","newCart","map","quantity","clearCart","reduce","sum","price","discount","discountPercentage","removeFromCart","delete","filter","updateQuantity","put","applyCoupon","code","_error$response","_error$response$data","getMyCoupon","console","removeCoupon"],"sources":["C:/Users/hasit/OneDrive/Desktop/PHEEEW--E-Commerce-App-main/frontend/src/stores/useCartStore.js"],"sourcesContent":["import { create } from \"zustand\";\nimport axios from '../lib/axios.js'; // ✅ ESM requires file extension\n\nimport { toast } from \"react-hot-toast\";\n\nexport const useCartStore = create((set, get) => ({\n\tcart: [],\n\tcoupon: null,\n\ttotal: 0,\n\tsubtotal: 0,\n\tisCouponApplied: false,\n    \n    getCartItems: async () => {\n\t\ttry {\n\t\t\tconst res = await axios.get(\"/cart\");\n\t\t\tset({ cart: res.data });\n\t\t\tget().calculateTotals();\n\t\t} catch (error) {\n\t\t\tset({ cart: [] });\n\t\t\ttoast.error(error.response.data.message || \"An error occurred\");\n\t\t}\n\t},\n    \n    addToCart: async (product) => {\n\t\ttry {\n\t\t\tawait axios.post(\"/cart\", { productId: product._id });\n\t\t\ttoast.success(\"Product added to cart\");\n\n\t\t\tset((prevState) => {\n\t\t\t\tconst existingItem = prevState.cart.find((item) => item._id === product._id);\n\t\t\t\tconst newCart = existingItem\n\t\t\t\t\t? prevState.cart.map((item) =>\n\t\t\t\t\t\t\titem._id === product._id ? { ...item, quantity: item.quantity + 1 } : item\n\t\t\t\t\t  )\n\t\t\t\t\t: [...prevState.cart, { ...product, quantity: 1 }];\n\t\t\t\treturn { cart: newCart };\n\t\t\t});\n\t\t\tget().calculateTotals();\n\t\t} catch (error) {\n\t\t\ttoast.error(error.response.data.message || \"An error occurred\");\n\t\t}\n    },\n    \n    clearCart: async () => {\n        set({ cart: [], coupon: null, total: 0, subtotal: 0 });\n        \n\t},\n    \n    calculateTotals: () => {\n\t\tconst { cart, coupon } = get();\n\t\tconst subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);\n\t\tlet total = subtotal;\n\n\t\tif (coupon) {\n\t\t\tconst discount = subtotal * (coupon.discountPercentage / 100);\n\t\t\ttotal = subtotal - discount;\n\t\t}\n\n\t\tset({ subtotal, total });\n    },\n    \n    removeFromCart: async (productId) => {\n\t\tawait axios.delete(`/cart`, { data: { productId } });\n\t\tset((prevState) => ({ cart: prevState.cart.filter((item) => item._id !== productId) }));\n        get().calculateTotals();\n        toast.success(\"Product removed from cart\");\n    },\n    \n    updateQuantity: async (productId, quantity) => {\n\t\tif (quantity === 0) {\n\t\t\tget().removeFromCart(productId);\n\t\t\treturn;\n\t\t}\n\n\t\tawait axios.put(`/cart/${productId}`, { quantity });\n\t\tset((prevState) => ({\n\t\t\tcart: prevState.cart.map((item) => (item._id === productId ? { ...item, quantity } : item)),\n\t\t}));\n\t\tget().calculateTotals();\n    },\n    \n    applyCoupon: async (code) => {\n\t\ttry {\n\t\t\tconst response = await axios.post(\"/coupons/validate\", { code });\n\t\t\tset({ coupon: response.data, isCouponApplied: true });\n\t\t\tget().calculateTotals();\n\t\t\ttoast.success(\"Coupon applied successfully\");\n\t\t} catch (error) {\n\t\t\ttoast.error(error.response?.data?.message || \"Failed to apply coupon\");\n\t\t}\n    },\n    \n    getMyCoupon: async () => {\n\t\ttry {\n\t\t\tconst response = await axios.get(\"/coupons\");\n\t\t\tset({ coupon: response.data });\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Error fetching coupon:\", error);\n\t\t}\n    },\n    \n    removeCoupon: () => {\n\t\tset({ coupon: null, isCouponApplied: false });\n\t\tget().calculateTotals();\n\t\ttoast.success(\"Coupon removed\");\n\t},\n}))\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}